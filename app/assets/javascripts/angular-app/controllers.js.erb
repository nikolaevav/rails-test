'use strict';

var booksControllers = angular.module('booksControllers', ['angularFileUpload']);

booksControllers.controller('BooksIndexCtrl', function($scope, Book) {
  $scope.books = Book.query();

  $scope.destroy = function(book_id) {
    new Book.destroy({id: book_id}, function(resource) {
      $('#book_' + book_id).remove();
    }, function (response) {
      console.log(response);
    });
  };
});

booksControllers.controller('BooksNewCtrl', function($scope, $routeParams, Book) {
  $scope.book = new Book();
});

booksControllers.controller('BooksShowCtrl', function($scope, $routeParams, Book) {
  $scope.book = Book.get({ id: $routeParams.id });
});

booksControllers.controller("BooksEditCtrl", function($scope, $routeParams, $location, Book, FileUploader) {
  var uploader = $scope.uploader = new FileUploader({
      url: "/books/"+ $routeParams.id,
      alias: 'book[image]',
      method: 'PUT',
      autoUpload: true
  });

  if ($routeParams.id) {
    $scope.book = Book.show({ id: $routeParams.id });
  } else {
    $scope.book = new Book();
  }

  $scope.submit = function() {
    console.log("submit")

    function success(response) {
      console.log("success", response)
      $location.path("/books");
    }

    if ($routeParams.id) {
      Book.update($scope.book, success);
    } else {
      Book.create($scope.book, success);
    }

  };

  $scope.cancel = function() {
    $location.path("/books/"+$scope.book.id);
  };

});

// ---
// generated by coffee-script 1.9.2